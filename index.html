<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="PPL Tracker" />
<meta name="theme-color" content="#0a0e1a" />
<title>PPL Tracker</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body { background: #0a0e1a; color: #e2e8f0; font-family: 'DM Sans', 'Segoe UI', system-ui, sans-serif; }
  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; }
  input[type=number] { -moz-appearance: textfield; }
  ::-webkit-scrollbar { width: 0; height: 0; }
  textarea { font-family: inherit; }
</style>
<link rel="manifest" href="data:application/manifest+json,{&quot;name&quot;:&quot;PPL Tracker&quot;,&quot;short_name&quot;:&quot;PPL&quot;,&quot;start_url&quot;:&quot;.&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;#0a0e1a&quot;,&quot;theme_color&quot;:&quot;#0a0e1a&quot;}">
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useCallback, useRef } = React;

// â”€â”€â”€ STORAGE (localStorage) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const store = {
  get: (key) => { try { return localStorage.getItem(key); } catch { return null; } },
  set: (key, val) => { try { localStorage.setItem(key, val); } catch {} },
};

function loadDayWeek(dayIdx, weekIdx) {
  const raw = store.get(`ppl:day${dayIdx}:week${weekIdx}`);
  return raw ? JSON.parse(raw) : {};
}

// Load current week data, falling back to previous week's weights if this week is blank
function loadDayWeekWithCarryover(dayIdx, weekIdx, day) {
  const current = loadDayWeek(dayIdx, weekIdx);
  // If any set in any exercise already has data, use as-is
  const hasData = Object.values(current).some(exData =>
    Object.values(exData).some(s => s && (s.weight || s.reps))
  );
  if (hasData || weekIdx === 0) return current;

  // Nothing logged yet this week â€” carry forward weights from the most recent prior week
  for (let w = weekIdx - 1; w >= 0; w--) {
    const prev = loadDayWeek(dayIdx, w);
    const prevHasWeights = Object.values(prev).some(exData =>
      Object.values(exData).some(s => s && s.weight)
    );
    if (!prevHasWeights) continue;

    // Copy weights only (not reps) into a fresh data object
    const carried = {};
    day.exercises.forEach((ex, exIdx) => {
      const prevEx = prev[exIdx] || {};
      carried[exIdx] = {};
      for (let s = 0; s < ex.sets; s++) {
        const prevSet = prevEx[s] || {};
        carried[exIdx][s] = { weight: prevSet.weight || "", reps: "" };
      }
    });
    return carried;
  }
  return current;
}
function saveDayWeek(dayIdx, weekIdx, data) {
  store.set(`ppl:day${dayIdx}:week${weekIdx}`, JSON.stringify(data));
}
function loadNotes(dayIdx, weekIdx) {
  return store.get(`ppl:notes:d${dayIdx}:w${weekIdx}`) || "";
}
function saveNotes(dayIdx, weekIdx, text) {
  store.set(`ppl:notes:d${dayIdx}:w${weekIdx}`, text);
}
function loadCurrentWeek() {
  const v = store.get("ppl:currentWeek");
  return v !== null ? parseInt(v) : 0;
}
function saveCurrentWeek(w) { store.set("ppl:currentWeek", String(w)); }
function loadCompleted() {
  const done = new Set();
  for (let d = 0; d < MESO.days; d++)
    for (let w = 0; w < (MESO ? MESO.weeks : 6); w++)
      if (store.get(`ppl:done:d${d}:w${w}`) === "1") done.add(`${d}:${w}`);
  return done;
}
function markComplete(dayIdx, weekIdx) {
  store.set(`ppl:done:d${dayIdx}:w${weekIdx}`, "1");
}
function loadProfile() {
  const raw = store.get("ppl:profile");
  return raw ? JSON.parse(raw) : null;
}
function saveProfile(profile) {
  store.set("ppl:profile", JSON.stringify(profile));
}
function resetMeso() {
  const weeks = MESO ? MESO.weeks : 6;
  const days = MESO ? MESO.days : 6;
  for (let d = 0; d < days; d++)
    for (let w = 0; w <= weeks; w++) {
      try { localStorage.removeItem(`ppl:day${d}:week${w}`); } catch {}
      try { localStorage.removeItem(`ppl:notes:d${d}:w${w}`); } catch {}
      try { localStorage.removeItem(`ppl:done:d${d}:w${w}`); } catch {}
    }
  saveCurrentWeek(0);
}

// â”€â”€â”€ MESO CONFIG BUILDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildMesoConfig(mesoLen, daysPerWeek) {
  const configs = {
    4: {
      phases: ["Accumulation","Accumulation","Peak","Peak"],
      rirs:   ["3 RIR","2 RIR","1 RIR","0-1 RIR"],
      mesoRows: [
        [0,"3 RIR","Accumulation","Establish baseline. Leave plenty in the tank. Form focus."],
        [1,"2 RIR","Accumulation","Match weights, refine technique. Add weight where it feels easy."],
        [2,"1 RIR","Peak","Push close to failure. +5 lbs on anchors."],
        [3,"0-1 RIR","Peak","PR attempts on anchors. Maximum effort week."],
        [null,"N/A","DELOAD","50-60% of peak weight. 2 sets only. Zero failure. Recover."],
      ],
    },
    6: {
      phases: ["Accumulation","Accumulation","Intensification","Intensification","Peak","Peak"],
      rirs:   ["3 RIR","2-3 RIR","2 RIR","1-2 RIR","1 RIR","0-1 RIR"],
      mesoRows: [
        [0,"3 RIR","Accumulation","Establish baseline. Leave plenty in the tank. Form focus."],
        [1,"2-3 RIR","Accumulation","Match weights with better technique. Small adds if easy."],
        [2,"2 RIR","Intensification","+5 lbs anchors. Push closer to failure on accessories."],
        [3,"1-2 RIR","Intensification","+5 lbs anchors again. Accessories +2.5-5 lbs."],
        [4,"1 RIR","Peak","+5 lbs. One rep from failure. Push hard."],
        [5,"0-1 RIR","Peak","PR attempts on anchors. Max effort week."],
        [null,"N/A","DELOAD","50-60% of W6 weight. 2 sets only. Zero failure. Recover."],
      ],
    },
    8: {
      phases: ["Accumulation","Accumulation","Accumulation","Intensification","Intensification","Intensification","Peak","Peak"],
      rirs:   ["4 RIR","3 RIR","2-3 RIR","2 RIR","1-2 RIR","1-2 RIR","1 RIR","0-1 RIR"],
      mesoRows: [
        [0,"4 RIR","Accumulation","Establish baseline. Technique first. Build the groove."],
        [1,"3 RIR","Accumulation","Small weight adds. Stay far from failure."],
        [2,"2-3 RIR","Accumulation","+2.5-5 lbs. Volume is the goal this block."],
        [3,"2 RIR","Intensification","Transition week. +5 lbs on anchors. Technique stays tight."],
        [4,"1-2 RIR","Intensification","+5 lbs. Push accessories near failure."],
        [5,"1-2 RIR","Intensification","Hold or add small. Fatigue management."],
        [6,"1 RIR","Peak","One rep from failure. PR setup week."],
        [7,"0-1 RIR","Peak","PR attempts on all anchors. Max effort."],
        [null,"N/A","DELOAD","50-60% of peak weight. 2 sets only. Zero failure. Recover."],
      ],
    },
    10: {
      phases: ["Accumulation","Accumulation","Accumulation","Accumulation","Intensification","Intensification","Intensification","Peak","Peak","Peak"],
      rirs:   ["4 RIR","3-4 RIR","3 RIR","2-3 RIR","2 RIR","1-2 RIR","1-2 RIR","1 RIR","0-1 RIR","0 RIR"],
      mesoRows: [
        [0,"4 RIR","Accumulation","Establish baseline. Volume focus. No heroics."],
        [1,"3-4 RIR","Accumulation","Small adds on anchors. Build work capacity."],
        [2,"3 RIR","Accumulation","+2.5-5 lbs across the board."],
        [3,"2-3 RIR","Accumulation","Final accumulation push. High volume."],
        [4,"2 RIR","Intensification","Transition to heavier loads. +5 lbs anchors."],
        [5,"1-2 RIR","Intensification","+5 lbs. Accessories follow suit."],
        [6,"1-2 RIR","Intensification","Hold or small adds. Manage fatigue."],
        [7,"1 RIR","Peak","One rep from failure. PR prep."],
        [8,"0-1 RIR","Peak","Near-limit loads. Set up the PR week."],
        [9,"0 RIR","Peak","Max effort. PR attempts on all anchors."],
        [null,"N/A","DELOAD","50-60% of peak weight. 2 sets only. Zero failure. Recover."],
      ],
    },
    12: {
      phases: ["Accumulation","Accumulation","Accumulation","Accumulation","Intensification","Intensification","Intensification","Intensification","Peak","Peak","Peak","Peak"],
      rirs:   ["4 RIR","4 RIR","3 RIR","3 RIR","2-3 RIR","2 RIR","2 RIR","1-2 RIR","1 RIR","0-1 RIR","0-1 RIR","0 RIR"],
      mesoRows: [
        [0,"4 RIR","Accumulation","Establish baseline. Long meso â€” patience pays off."],
        [1,"4 RIR","Accumulation","Refine technique. Small adds only if very easy."],
        [2,"3 RIR","Accumulation","+2.5 lbs. Build the volume base."],
        [3,"3 RIR","Accumulation","+2.5-5 lbs. Final volume block push."],
        [4,"2-3 RIR","Intensification","Transition. +5 lbs anchors. Technique stays tight."],
        [5,"2 RIR","Intensification","+5 lbs across. Push accessories toward failure."],
        [6,"2 RIR","Intensification","Hold or +2.5 lbs. Fatigue management block."],
        [7,"1-2 RIR","Intensification","Final intensification push. High load, controlled failure."],
        [8,"1 RIR","Peak","One rep from failure. PR setup begins."],
        [9,"0-1 RIR","Peak","Near-limit. Lock in the numbers."],
        [10,"0-1 RIR","Peak","Set your stage. Final prep."],
        [11,"0 RIR","Peak","Max effort. PR attempts on all anchors."],
        [null,"N/A","DELOAD","50-60% of peak weight. 2 sets only. Zero failure. Recover."],
      ],
    },
  };
  const cfg = configs[mesoLen] || configs[6];
  // Build progressive overload targets scaled to meso length
  const pw = Array.from({length:mesoLen}, (_,i) => {
    if (i === 0) return "Establish";
    if (i === mesoLen-1) return "PR attempt";
    if (i < Math.ceil(mesoLen*0.4)) return "+ 2.5 lbs";
    return "+5 lbs";
  });
  const pr = Array.from({length:mesoLen}, (_,i) => {
    if (i === 0) return "Establish";
    if (i === mesoLen-1) return "Max reps / PR";
    if (i === Math.floor(mesoLen/2)) return "â†‘ weight";
    return "+1-2 reps";
  });
  return {
    weeks: mesoLen,
    days: daysPerWeek || 6,
    phases: [...cfg.phases, "Deload"],
    rirs:   [...cfg.rirs,   "N/A â€” DELOAD"],
    mesoRows: cfg.mesoRows,
    progTargets: { weight: pw, reps: pr },
  };
}

// â”€â”€â”€ BACKUP / RESTORE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportData() {
  const data = {};
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key && key.startsWith("ppl:")) data[key] = localStorage.getItem(key);
  }
  const blob = new Blob([JSON.stringify({ version:1, exportedAt: new Date().toISOString(), data }, null, 2)], { type:"application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `ppl-backup-${new Date().toISOString().slice(0,10)}.json`;
  document.body.appendChild(a);
  a.click();
  setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(url); }, 500);
}

function importData(file, onDone) {
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const parsed = JSON.parse(e.target.result);
      const data = parsed.data || parsed; // support both formats
      Object.entries(data).forEach(([k,v]) => {
        if (k.startsWith("ppl:")) localStorage.setItem(k, v);
      });
      onDone(true);
    } catch {
      onDone(false);
    }
  };
  reader.readAsText(file);
}

// â”€â”€â”€ COMPUTE MESO CONFIG FROM STORED PROFILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const _storedProfile = (() => { try { return JSON.parse(localStorage.getItem("ppl:profile")); } catch { return null; } })();
let MESO = buildMesoConfig(_storedProfile?.mesoLength || 6, _storedProfile?.daysPerWeek || 6);

// Active days based on daysPerWeek â€” 3-day uses Push1/Pull1/Legs1, 6-day uses all 6
// (defined after DAYS, so we forward-declare; actual slice happens after DAYS is defined)

// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Dynamic arrays â€” all derived from MESO config (computed above based on profile)
const WEEK_RIR    = MESO.rirs;
const WEEK_PHASE  = MESO.phases;
const PROG_TARGETS= MESO.progTargets;
const MESO_ROWS   = MESO.mesoRows;
const PHASE_COLOR = { Accumulation:"#22c55e", Intensification:"#f59e0b", Peak:"#ef4444", Deload:"#8b5cf6" };
const TAG_ACCENT  = { PUSH:"#60a5fa", PULL:"#34d399", LEGS:"#f59e0b" };
const WARMUP = [
  { load:"40%", reps:"8",  note:"Prime the movement, build the groove" },
  { load:"60%", reps:"5",  note:"Neural prep â€” check form and bar path" },
  { load:"75%", reps:"3",  note:"Dial in weight, feel the tension" },
  { load:"90%", reps:"1",  note:"Final primer â€” go heavy on working sets" },
];
const QUOTES = [
  { text: "We are what we repeatedly do. Excellence, then, is not an act, but a habit.", author: "Aristotle" },
  { text: "Discipline is choosing between what you want now and what you want most.", author: "Abraham Lincoln" },
  { text: "The secret of getting ahead is getting started.", author: "Mark Twain" },
  { text: "Don't count the days, make the days count.", author: "Muhammad Ali" },
  { text: "Success isn't always about greatness. It's about consistency.", author: "Dwayne Johnson" },
  { text: "You don't have to be great to start, but you have to start to be great.", author: "Zig Ziglar" },
  { text: "Small daily improvements over time lead to stunning results.", author: "Robin Sharma" },
  { text: "The pain you feel today will be the strength you feel tomorrow.", author: "Arnold Schwarzenegger" },
  { text: "Motivation gets you started. Habit keeps you going.", author: "Jim Ryun" },
  { text: "Strength does not come from the body. It comes from the will of the soul.", author: "Mahatma Gandhi" },
  { text: "The only bad workout is the one that didn't happen.", author: "Unknown" },
  { text: "Your body can stand almost anything. It's your mind you have to convince.", author: "Unknown" },
  { text: "If it doesn't challenge you, it doesn't change you.", author: "Fred DeVito" },
  { text: "The harder you work for something, the greater you'll feel when you achieve it.", author: "Unknown" },
  { text: "Push yourself because no one else is going to do it for you.", author: "Unknown" },
  { text: "Tough times never last, but tough people do.", author: "Robert H. Schuller" },
  { text: "The difference between the impossible and the possible lies in determination.", author: "Tommy Lasorda" },
  { text: "Go the extra mile. It's never crowded.", author: "Wayne Dyer" },
  { text: "Champions aren't made in gyms. Champions are made from something they have deep inside.", author: "Muhammad Ali" },
  { text: "The only way to define your limits is by going beyond them.", author: "Arthur C. Clarke" },
  { text: "Great things never came from comfort zones.", author: "Unknown" },
  { text: "Whether you think you can or you think you can't, you're right.", author: "Henry Ford" },
  { text: "It's not whether you get knocked down, it's whether you get up.", author: "Vince Lombardi" },
  { text: "The mind is the limit. As long as the mind can envision it, you can achieve it.", author: "Arnold Schwarzenegger" },
  { text: "You miss 100% of the shots you don't take.", author: "Wayne Gretzky" },
  { text: "I never lose. I either win or I learn.", author: "Nelson Mandela" },
  { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
  { text: "The only person you are destined to become is the person you decide to be.", author: "Ralph Waldo Emerson" },
  { text: "Do something today that your future self will thank you for.", author: "Sean Patrick Flanery" },
  { text: "Act as if what you do makes a difference. It does.", author: "William James" },
  { text: "Success is the sum of small efforts, repeated day in and day out.", author: "Robert Collier" },
  { text: "You don't get what you wish for. You get what you work for.", author: "Unknown" },
  { text: "The only limit to our realization of tomorrow is our doubts of today.", author: "Franklin D. Roosevelt" },
  { text: "With self-discipline, almost anything is possible.", author: "Theodore Roosevelt" },
  { text: "When you feel like quitting, think about why you started.", author: "Unknown" },
  { text: "It always seems impossible until it's done.", author: "Nelson Mandela" },
  { text: "Fall seven times, stand up eight.", author: "Japanese Proverb" },
  { text: "Hardships often prepare ordinary people for an extraordinary destiny.", author: "C.S. Lewis" },
  { text: "I am not a product of my circumstances. I am a product of my decisions.", author: "Stephen Covey" },
  { text: "Your life does not get better by chance. It gets better by change.", author: "Jim Rohn" },
  { text: "Don't wish it were easier. Wish you were better.", author: "Jim Rohn" },
  { text: "A goal without a plan is just a wish.", author: "Antoine de Saint-ExupÃ©ry" },
  { text: "Set your goals high and don't stop until you get there.", author: "Bo Jackson" },
  { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
  { text: "Focus on the process, not the outcome.", author: "Unknown" },
  { text: "The man who moves a mountain begins by carrying away small stones.", author: "Confucius" },
  { text: "Vision without action is a daydream. Action without vision is a nightmare.", author: "Japanese Proverb" },
  { text: "If you want to achieve greatness, stop asking for permission.", author: "Unknown" },
  { text: "Keep your eyes on the stars and your feet on the ground.", author: "Theodore Roosevelt" },
  { text: "You can't climb the ladder of success with your hands in your pockets.", author: "Arnold Schwarzenegger" },
  { text: "Nothing is particularly hard if you divide it into small jobs.", author: "Henry Ford" },
  { text: "Dream big. Work hard. Stay focused.", author: "Unknown" },
  { text: "What you get by achieving your goals is not as important as what you become.", author: "Henry David Thoreau" },
  { text: "Our greatest weakness lies in giving up. The most certain way to succeed is always to try one more time.", author: "Thomas Edison" },
  { text: "Energy and persistence conquer all things.", author: "Benjamin Franklin" },
  { text: "Perseverance is not a long race; it is many short races one after the other.", author: "Walter Elliot" },
  { text: "It does not matter how slowly you go as long as you do not stop.", author: "Confucius" },
  { text: "Keep going. Your hardest times often lead to the greatest moments.", author: "Roy T. Bennett" },
  { text: "The difference between a successful person and others is not lack of strength, but lack of will.", author: "Vince Lombardi" },
  { text: "You've got to get up every morning with determination if you're going to go to bed with satisfaction.", author: "George Lorimer" },
  { text: "Strength grows in the moments when you think you can't go on but you keep going anyway.", author: "Unknown" },
  { text: "You are braver than you believe, stronger than you seem.", author: "A.A. Milne" },
  { text: "What lies behind us and what lies before us are tiny matters compared to what lies within us.", author: "Ralph Waldo Emerson" },
  { text: "You never know how strong you are until being strong is your only option.", author: "Bob Marley" },
  { text: "Rock bottom will teach you lessons that mountain tops never will.", author: "Unknown" },
  { text: "Take care of your body. It's the only place you have to live.", author: "Jim Rohn" },
  { text: "Your health is an investment, not an expense.", author: "Unknown" },
  { text: "Fitness is not about being better than someone else. It's about being better than you used to be.", author: "Unknown" },
  { text: "The groundwork for all happiness is good health.", author: "Leigh Hunt" },
  { text: "Exercise is a celebration of what your body can do. Not a punishment for what you ate.", author: "Unknown" },
  { text: "The body achieves what the mind believes.", author: "Napoleon Hill" },
  { text: "To keep the body in good health is a duty, otherwise we shall not be able to keep our mind strong and clear.", author: "Buddha" },
  { text: "A strong body makes the mind strong.", author: "Thomas Jefferson" },
  { text: "You don't have to be extreme, just consistent.", author: "Unknown" },
  { text: "Strive for progress, not perfection.", author: "Unknown" },
  { text: "One month from now you will thank yourself.", author: "Unknown" },
  { text: "Every workout is progress.", author: "Unknown" },
  { text: "I hated every minute of training, but I said, don't quit. Suffer now and live the rest of your life as a champion.", author: "Muhammad Ali" },
  { text: "Hard work beats talent when talent doesn't work hard.", author: "Tim Notke" },
  { text: "I've failed over and over again. And that is why I succeed.", author: "Michael Jordan" },
  { text: "Some people want it to happen, some wish it would happen, others make it happen.", author: "Michael Jordan" },
  { text: "The more I practice, the luckier I get.", author: "Arnold Palmer" },
  { text: "If you're tired of starting over, stop giving up.", author: "Unknown" },
  { text: "Today I will do what others won't, so tomorrow I can do what others can't.", author: "Jerry Rice" },
  { text: "Pain is temporary. Quitting lasts forever.", author: "Lance Armstrong" },
  { text: "Most people give up just when they're about to achieve success.", author: "Ross Perot" },
  { text: "The vision of a champion is bent over, drenched in sweat, at the point of exhaustion, when nobody else is looking.", author: "Mia Hamm" },
  { text: "There may be people that have more talent than you, but there's no excuse for anyone to work harder than you do.", author: "Derek Jeter" },
  { text: "The more difficult the victory, the greater the happiness in winning.", author: "PelÃ©" },
  { text: "I can accept failure, everyone fails at something. But I can't accept not trying.", author: "Michael Jordan" },
  { text: "Believe in yourself and all that you are. Know that there is something inside you that is greater than any obstacle.", author: "Christian D. Larson" },
  { text: "You are stronger than you think.", author: "Unknown" },
  { text: "The most powerful weapon you have is your mind.", author: "Unknown" },
  { text: "Don't stop when you're tired. Stop when you're done.", author: "Unknown" },
  { text: "Be proud of every step you take toward your goal, no matter how small.", author: "Unknown" },
  { text: "You're not here to be average. You're here to be awesome.", author: "Unknown" },
  { text: "You've survived 100% of your worst days so far.", author: "Unknown" },
  { text: "You are capable of more than you know.", author: "E.O. Wilson" },
  { text: "Doubt kills more dreams than failure ever will.", author: "Suzy Kassem" },
  { text: "The comeback is always stronger than the setback.", author: "Unknown" },
  { text: "You are what you do, not what you say you'll do.", author: "Carl Jung" },
  { text: "Prove them wrong.", author: "Unknown" },
  { text: "Be the person you needed when you were younger.", author: "Unknown" },
  { text: "You didn't come this far to only come this far.", author: "Unknown" },
  { text: "Every rep counts. Every set matters. Every session builds the person you're becoming.", author: "Unknown" },
  { text: "Physical fitness is not only one of the most important keys to a healthy body, it is the basis of dynamic and creative intellectual activity.", author: "John F. Kennedy" },
  { text: "It's not about the destination, it's about the journey.", author: "Ralph Waldo Emerson" },
  { text: "Life is not about waiting for the storms to pass. It's about learning how to dance in the rain.", author: "Vivian Greene" },
  { text: "One step at a time is all it takes to get you there.", author: "Emily Dickinson" },
  { text: "Inch by inch, anything's a cinch.", author: "Robert H. Schuller" },
  { text: "You were born to be a player. You were meant to be here.", author: "Herb Brooks" },
  { text: "Eat right, train hard, sleep well, repeat.", author: "Unknown" },
];

const CONGRATS = [
  { emoji: "ğŸ”¥", headline: "THAT'S A WRAP!", sub: "You showed up, you put in the work, and you earned every rep. That's what this is all about." },
  { emoji: "ğŸ’ª", headline: "SESSION CRUSHED!", sub: "Another one in the books. Your future self is already thanking you for today." },
  { emoji: "âš¡", headline: "BEAST MODE ACTIVATED.", sub: "You came, you lifted, you conquered. This is how champions are built â€” one session at a time." },
  { emoji: "ğŸ†", headline: "WORK COMPLETE.", sub: "Not everyone shows up. You did. That's the difference between who you are and who they'll never be." },
  { emoji: "ğŸ¯", headline: "MISSION ACCOMPLISHED.", sub: "You made a commitment and you kept it. That's the foundation everything else is built on." },
  { emoji: "ğŸ’¥", headline: "ABSOLUTELY LOCKED IN.", sub: "That session is done and you are getting better. Every single time. No exceptions." },
  { emoji: "ğŸš€", headline: "LIFT COMPLETE. LET'S GO!", sub: "Rest up, eat your protein, and get ready â€” the next session is already on deck." },
  { emoji: "ğŸ¦¾", headline: "STRONGER THAN YESTERDAY.", sub: "You didn't just train today. You invested in the version of yourself that doesn't quit." },
];

// gender: 'm'=male-leaning, 'f'=female-leaning, 'a'=any
const QUOTES_FEMALE = [
  { text: "I'd rather regret the things I've done than regret the things I haven't done.", author: "Lucille Ball" },
  { text: "A woman is like a tea bag â€” you never know how strong she is until she gets in hot water.", author: "Eleanor Roosevelt" },
  { text: "Well-behaved women seldom make history.", author: "Laurel Thatcher Ulrich" },
  { text: "I am not afraid of storms, for I am learning how to sail my ship.", author: "Louisa May Alcott" },
  { text: "The question isn't who's going to let me; it's who's going to stop me.", author: "Ayn Rand" },
  { text: "She believed she could, so she did.", author: "R.S. Grey" },
  { text: "Nothing is impossible. The word itself says 'I'm possible.'", author: "Audrey Hepburn" },
  { text: "I can and I will. Watch me.", author: "Carrie Green" },
  { text: "Think like a queen. A queen is not afraid to fail. Failure is another stepping stone to greatness.", author: "Oprah Winfrey" },
  { text: "No one can make you feel inferior without your consent.", author: "Eleanor Roosevelt" },
  { text: "Strong women don't have attitudes â€” they have standards.", author: "Unknown" },
  { text: "Make yourself a priority once in a while. It's not selfish. It's necessary.", author: "Unknown" },
  { text: "A strong woman looks a challenge dead in the eye and gives it a wink.", author: "Gina Carey" },
  { text: "The most alluring thing a woman can have is confidence.", author: "BeyoncÃ©" },
  { text: "The vision of a champion is bent over, drenched in sweat, at the point of exhaustion, when nobody else is looking.", author: "Mia Hamm" },
  { text: "Lift up your head queen, if not the crown falls.", author: "Unknown" },
  { text: "Be your own hero. It's cheaper than therapy and more fun.", author: "Unknown" },
  { text: "You are more powerful than you know; you are beautiful just as you are.", author: "Melissa Etheridge" },
];

const QUOTES_MALE = [
  { text: "I hated every minute of training, but I said, don't quit. Suffer now and live the rest of your life as a champion.", author: "Muhammad Ali" },
  { text: "The mind is the limit. As long as the mind can envision it, you can achieve it.", author: "Arnold Schwarzenegger" },
  { text: "You can't climb the ladder of success with your hands in your pockets.", author: "Arnold Schwarzenegger" },
  { text: "Today I will do what others won't, so tomorrow I can do what others can't.", author: "Jerry Rice" },
  { text: "Pain is temporary. Quitting lasts forever.", author: "Lance Armstrong" },
  { text: "There may be people that have more talent than you, but there's no excuse for anyone to work harder than you do.", author: "Derek Jeter" },
  { text: "I've failed over and over again. And that is why I succeed.", author: "Michael Jordan" },
  { text: "Some people want it to happen, some wish it would happen, others make it happen.", author: "Michael Jordan" },
  { text: "I can accept failure, everyone fails at something. But I can't accept not trying.", author: "Michael Jordan" },
  { text: "Champions aren't made in gyms. Champions are made from something they have deep inside.", author: "Muhammad Ali" },
  { text: "Don't count the days, make the days count.", author: "Muhammad Ali" },
  { text: "Success isn't always about greatness. It's about consistency.", author: "Dwayne Johnson" },
  { text: "The more difficult the victory, the greater the happiness in winning.", author: "PelÃ©" },
  { text: "You were born to be a player. You were meant to be here.", author: "Herb Brooks" },
  { text: "Hard work beats talent when talent doesn't work hard.", author: "Tim Notke" },
  { text: "Most people give up just when they're about to achieve success.", author: "Ross Perot" },
  { text: "The more I practice, the luckier I get.", author: "Arnold Palmer" },
  { text: "Set your goals high and don't stop until you get there.", author: "Bo Jackson" },
];

// 2:1 ratio â€” gender-specific quotes appear twice as often as neutral ones
function randomQuote(gender) {
  let pool;
  if (gender === 'f') {
    // 2 parts female-specific + 1 part neutral
    pool = [...QUOTES_FEMALE, ...QUOTES_FEMALE, ...QUOTES];
  } else if (gender === 'm') {
    // 2 parts male-specific + 1 part neutral
    pool = [...QUOTES_MALE, ...QUOTES_MALE, ...QUOTES];
  } else {
    // other/unset â€” full neutral pool
    pool = QUOTES;
  }
  return pool[Math.floor(Math.random() * pool.length)];
}
function randomCongrats() { return CONGRATS[Math.floor(Math.random() * CONGRATS.length)]; }

const CALENDAR = [
  {day:"MON",dayIdx:0,cardio:"4x4 #1 PM"},
  {day:"TUE",dayIdx:1,cardio:null},
  {day:"WED",dayIdx:2,cardio:null},
  {day:"THU",dayIdx:3,cardio:null},
  {day:"FRI",dayIdx:4,cardio:"4x4 #2 PM"},
  {day:"SAT",dayIdx:5,cardio:null},
  {day:"SUN",dayIdx:null,cardio:null},
];
const DAYS = [
  {
    dayNum:1, label:"Push Day 1", tag:"PUSH", muscles:"Chest Â· Shoulders Â· Triceps",
    note:"Flat bench is your anchor â€” full range, controlled negative. Drive hard at the top.",
    cardio:"4x4 #1 (PM)",
    exercises:[
      {name:"DB Flat Bench Press",         muscle:"Chest",          sets:4, reps:"4-6",     rest:"3-4 min",   warmup:"Full protocol",      progression:"weight", anchor:true},
      {name:"Incline DB Press",            muscle:"Upper Chest",    sets:3, reps:"8-10",    rest:"2 min",     warmup:"1 feeler set",       progression:"reps"},
      {name:"DB Overhead Press",           muscle:"Front Delts",    sets:3, reps:"8-10",    rest:"2 min",     warmup:"1 feeler set",       progression:"reps"},
      {name:"Cable Lateral Raise",         muscle:"Side Delts",     sets:4, reps:"12-15",   rest:"60-90 sec", warmup:"â€”",                  progression:"reps"},
      {name:"Cable Tricep Pushdown",       muscle:"Triceps",        sets:3, reps:"10-12",   rest:"60-90 sec", warmup:"â€”",                  progression:"reps"},
      {name:"DB Overhead Tricep Ext.",     muscle:"Long Head Tri",  sets:3, reps:"10-12",   rest:"60 sec",    warmup:"â€”",                  progression:"reps"},
    ]
  },
  {
    dayNum:2, label:"Pull Day 1", tag:"PULL", muscles:"Back Â· Biceps Â· Rear Delts",
    note:"Barbell row is your anchor â€” overhand grip, pull to your belly button. Stay tight.",
    cardio:null,
    exercises:[
      {name:"Barbell Bent-Over Row",       muscle:"Mid Back / Lats", sets:4, reps:"4-6",     rest:"3-4 min",   warmup:"Full protocol",      progression:"weight", anchor:true},
      {name:"Cable Lat Pulldown",          muscle:"Lats",            sets:3, reps:"8-10",    rest:"2 min",     warmup:"1 feeler set",       progression:"reps"},
      {name:"Seated Cable Row",            muscle:"Rhomboids",       sets:3, reps:"10-12",   rest:"90 sec",    warmup:"1 feeler set",       progression:"reps"},
      {name:"DB Rear Delt Fly",            muscle:"Rear Delts",      sets:3, reps:"15",      rest:"60 sec",    warmup:"â€”",                  progression:"reps"},
      {name:"DB Bicep Curl",               muscle:"Biceps",          sets:3, reps:"8-10",    rest:"90 sec",    warmup:"â€”",                  progression:"weight"},
      {name:"DB Hammer Curl",              muscle:"Brachialis",      sets:3, reps:"10-12",   rest:"60 sec",    warmup:"â€”",                  progression:"reps"},
    ]
  },
  {
    dayNum:3, label:"Legs Day 1", tag:"LEGS", muscles:"Quads Â· Hamstrings Â· Glutes Â· Calves",
    note:"Back squat is king â€” full warm-up every time. Electrolytes before this session.",
    cardio:null,
    exercises:[
      {name:"Barbell Back Squat",          muscle:"Quads / Glutes",  sets:4, reps:"4-6",     rest:"3-5 min",   warmup:"Full protocol",      progression:"weight", anchor:true},
      {name:"DB Romanian Deadlift",        muscle:"Hamstrings",      sets:3, reps:"8-10",    rest:"2 min",     warmup:"1 feeler set",       progression:"weight"},
      {name:"Leg Press",                   muscle:"Quads",           sets:3, reps:"10-12",   rest:"2 min",     warmup:"1 feeler set",       progression:"reps"},
      {name:"Machine Leg Curl",            muscle:"Hamstrings",      sets:3, reps:"10-12",   rest:"90 sec",    warmup:"â€”",                  progression:"reps"},
      {name:"Machine Calf Raise",          muscle:"Gastrocnemius",   sets:4, reps:"15",      rest:"60 sec",    warmup:"â€”",                  progression:"reps"},
    ]
  },
  {
    dayNum:4, label:"Push Day 2", tag:"PUSH", muscles:"Chest Â· Shoulders Â· Triceps (Variation)",
    note:"Incline DB press anchors today â€” different angle than Day 1. Cable fly for max chest stretch.",
    cardio:null,
    exercises:[
      {name:"Incline DB Press",             muscle:"Upper Chest",    sets:4, reps:"4-6",     rest:"3-4 min",   warmup:"Full protocol",      progression:"weight", anchor:true},
      {name:"Cable Chest Fly (low-to-high)",muscle:"Mid Chest",      sets:3, reps:"10-12",   rest:"90 sec",    warmup:"1 feeler set",       progression:"reps"},
      {name:"DB Arnold Press",              muscle:"Shoulders",      sets:3, reps:"10-12",   rest:"2 min",     warmup:"1 feeler set",       progression:"reps"},
      {name:"Cable Lateral Raise",          muscle:"Side Delts",     sets:3, reps:"15",      rest:"60 sec",    warmup:"â€”",                  progression:"reps"},
      {name:"Machine Dip / Tricep Press",   muscle:"Triceps",        sets:3, reps:"8-10",    rest:"90 sec",    warmup:"â€”",                  progression:"weight"},
      {name:"Cable Overhead Tricep Ext.",   muscle:"Long Head Tri",  sets:3, reps:"12",      rest:"60-90 sec", warmup:"â€”",                  progression:"reps"},
    ]
  },
  {
    dayNum:5, label:"Pull Day 2", tag:"PULL", muscles:"Back Â· Biceps Â· Rear Delts (Variation)",
    note:"Weighted pull-ups anchor today â€” use a belt if bodyweight is easy.",
    cardio:"4x4 #2 (PM)",
    exercises:[
      {name:"Weighted Pull-ups",            muscle:"Lats / Biceps",  sets:4, reps:"4-6",     rest:"3-4 min",   warmup:"BW ramp: 5, 3, 1",  progression:"weight", anchor:true},
      {name:"DB Single Arm Row",            muscle:"Lats / Mid Back",sets:3, reps:"8-10 ea.",rest:"90 sec",    warmup:"1 feeler set",       progression:"weight"},
      {name:"Cable Straight Arm Pulldown",  muscle:"Teres Major",    sets:3, reps:"12-15",   rest:"90 sec",    warmup:"â€”",                  progression:"reps"},
      {name:"Cable Face Pull",              muscle:"Rear Delts / RC",sets:3, reps:"15",      rest:"60 sec",    warmup:"â€”",                  progression:"reps"},
      {name:"Incline DB Curl",              muscle:"Long Head Bi",   sets:3, reps:"10-12",   rest:"90 sec",    warmup:"â€”",                  progression:"reps"},
      {name:"Cable Curl (EZ bar / rope)",   muscle:"Biceps",         sets:3, reps:"12",      rest:"60 sec",    warmup:"â€”",                  progression:"reps"},
    ]
  },
  {
    dayNum:6, label:"Legs Day 2", tag:"LEGS", muscles:"Hamstrings Â· Glutes Â· Quads (Variation)",
    note:"Barbell deadlift anchors â€” hinge-dominant day. Drive the floor away, keep the bar close.",
    cardio:null,
    exercises:[
      {name:"Barbell Conventional Deadlift",muscle:"Hamstrings / Glutes",sets:4, reps:"4-6",  rest:"3-5 min",   warmup:"Full protocol",      progression:"weight", anchor:true},
      {name:"Hack Squat",                   muscle:"Quads",          sets:3, reps:"8-10",    rest:"2 min",     warmup:"1 feeler set",       progression:"reps"},
      {name:"DB Bulgarian Split Squat",     muscle:"Glutes / Quads", sets:3, reps:"8-10 ea.",rest:"2 min",     warmup:"1 feeler set",       progression:"weight"},
      {name:"Machine Leg Curl (seated)",    muscle:"Hamstrings",     sets:3, reps:"12",      rest:"90 sec",    warmup:"â€”",                  progression:"reps"},
      {name:"Machine Calf Raise (seated)",  muscle:"Soleus",         sets:4, reps:"15",      rest:"60 sec",    warmup:"â€”",                  progression:"reps"},
    ]
  },
];

// Slice DAYS to match selected daysPerWeek (3 = Push1/Pull1/Legs1, 6 = full PPLÃ—2)
const ACTIVE_DAYS = DAYS.slice(0, MESO.days);

// â”€â”€â”€ SMALL UI HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const pill = (color, children) => (
  <span style={{
    display:"inline-flex", alignItems:"center", padding:"3px 9px",
    borderRadius:99, background:color+"22", color, fontSize:11, fontWeight:700, letterSpacing:"0.06em"
  }}>{children}</span>
);

// â”€â”€â”€ WEEK BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function WeekBar({ currentWeek, onChange }) {
  return (
    <div style={{display:"flex", gap:6, padding:"14px 16px 0", overflowX:"auto", WebkitOverflowScrolling:"touch"}}>
      {[0,1,2,3,4,5].map(w => {
        const active = w === currentWeek;
        const pc = PHASE_COLOR[WEEK_PHASE[w]];
        return (
          <button key={w} onClick={()=>onChange(w)} style={{
            flex:"0 0 auto", padding:"8px 14px", borderRadius:8, cursor:"pointer",
            background: active ? pc+"33" : "#0f1829",
            border:`1px solid ${active ? pc : "#1e2d47"}`,
            color: active ? pc : "#94a3b8",
            fontWeight:700, fontSize:13, transition:"all 0.15s",
          }}>
            <div>W{w+1}</div>
            <div style={{fontSize:9, opacity:0.8, marginTop:2}}>{WEEK_RIR[w]}</div>
          </button>
        );
      })}
    </div>
  );
}

// â”€â”€â”€ CALENDAR STRIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function CalendarStrip({ currentWeek, onSelectDay, completedDays }) {
  return (
    <div style={{display:"grid", gridTemplateColumns:"repeat(7,1fr)", gap:4, padding:"14px 16px"}}>
      {CALENDAR.map(({day, dayIdx}, i) => {
        const isRest = dayIdx === null;
        const done = !isRest && completedDays.has(`${dayIdx}:${currentWeek}`);
        const accent = !isRest ? TAG_ACCENT[DAYS[dayIdx].tag] : "#334155";
        return (
          <button key={day} onClick={()=>!isRest && onSelectDay(dayIdx)} style={{
            background: done ? accent+"22" : "#0f1829",
            border:`1px solid ${done ? accent : "#1e2d47"}`,
            borderRadius:8, padding:"8px 4px", cursor: isRest ? "default" : "pointer",
            display:"flex", flexDirection:"column", alignItems:"center", gap:4, transition:"all 0.15s",
          }}>
            <span style={{fontSize:10, fontWeight:700, letterSpacing:"0.06em", color: isRest ? "#2a3550" : "#94a3b8"}}>{day}</span>
            {!isRest
              ? <><span style={{fontSize:9, color:accent, fontWeight:700}}>{DAYS[dayIdx].tag}</span>
                  {done && <span style={{fontSize:12}}>âœ“</span>}</>
              : <span style={{fontSize:9, color:"#2a3550"}}>REST</span>
            }
          </button>
        );
      })}
    </div>
  );
}

// â”€â”€â”€ MESO OVERVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function MesoOverview() {
  return (
    <div style={{margin:"0 16px", background:"#0f1829", border:"1px solid #1e2d47", borderRadius:12, overflow:"hidden"}}>
      <div style={{padding:"12px 16px", borderBottom:"1px solid #1e2d47"}}>
        <span style={{fontSize:11, fontWeight:700, letterSpacing:"0.12em", color:"#60a5fa"}}>6-WEEK MESO OVERVIEW</span>
      </div>
      {MESO_ROWS.map(([w, rir, phase, note], i) => {
        const isDeload = w === null;
        const pc = !isDeload ? PHASE_COLOR[phase] : "#60a5fa";
        return (
          <div key={i} style={{
            padding:"10px 16px", borderBottom: i < MESO_ROWS.length-1 ? "1px solid #111827" : "none",
            display:"flex", alignItems:"flex-start", gap:12,
            background: isDeload ? "#0d1829" : "transparent",
          }}>
            <div style={{textAlign:"center", minWidth:32, paddingTop:2}}>
              <div style={{fontSize:14, fontWeight:800, color:pc}}>{isDeload ? "D" : `W${w+1}`}</div>
              <div style={{fontSize:9, color:"#94a3b8", marginTop:2}}>{rir}</div>
            </div>
            <div style={{flex:1}}>
              <div style={{fontSize:10, color:pc, fontWeight:700, marginBottom:3}}>{phase.toUpperCase()}</div>
              <div style={{fontSize:12, color:"#60a5fa", lineHeight:1.5}}>{note}</div>
            </div>
          </div>
        );
      })}
    </div>
  );
}

// â”€â”€â”€ WARMUP CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function WarmupCard() {
  return (
    <div style={{margin:"0 16px", background:"#0f1829", border:"1px solid #1e2d47", borderRadius:12, overflow:"hidden"}}>
      <div style={{padding:"12px 16px", borderBottom:"1px solid #1e2d47"}}>
        <span style={{fontSize:11, fontWeight:700, letterSpacing:"0.12em", color:"#60a5fa"}}>âš¡ ANCHOR LIFT WARM-UP</span>
      </div>
      {WARMUP.map(({load, reps, note}, i) => (
        <div key={i} style={{
          padding:"12px 16px", display:"flex", alignItems:"center", gap:14,
          borderBottom: i < 3 ? "1px solid #111827" : "none",
        }}>
          <div style={{width:38, textAlign:"center", fontSize:16, fontWeight:800, color:"#60a5fa"}}>{load}</div>
          <div style={{width:28, textAlign:"center", fontSize:14, fontWeight:700, color:"#e2e8f0"}}>{reps}</div>
          <div style={{fontSize:13, color:"#4ade80"}}>{note}</div>
        </div>
      ))}
      <div style={{padding:"10px 16px", borderTop:"1px solid #1e2d47", background:"#0d1220"}}>
        <span style={{fontSize:12, color:"#94a3b8"}}>All other exercises: 1 light feeler set only</span>
      </div>
    </div>
  );
}

// â”€â”€â”€ SETUP PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SetupPage({ onComplete }) {
  const [form, setForm] = useState({ name:"", age:"", gender:"", weight:"", goal:"", mesoLength:6, daysPerWeek:6 });
  const [error, setError] = useState("");

  const set = (k, v) => setForm(f => ({...f, [k]: v}));

  const handleSubmit = () => {
    if (!form.name.trim()) { setError("Please enter your name."); return; }
    if (!form.gender) { setError("Please select a gender."); return; }
    setError("");
    onComplete(form);
  };

  const inputStyle = {
    width:"100%", background:"#0f1829", border:"1px solid #1e2d47", borderRadius:10,
    color:"#e2e8f0", fontSize:16, padding:"14px", outline:"none",
    fontFamily:"inherit", marginTop:8,
  };
  const labelStyle = { fontSize:12, fontWeight:700, letterSpacing:"0.1em", color:"#60a5fa" };

  return (
    <div style={{minHeight:"100vh", background:"#0a0e1a", display:"flex", flexDirection:"column", maxWidth:480, margin:"0 auto"}}>
      {/* Hero */}
      <div style={{
        background:"linear-gradient(160deg, #0d1829 0%, #0a1220 100%)",
        borderBottom:"1px solid #1e2d47", padding:"48px 24px 32px", textAlign:"center",
      }}>
        <div style={{fontSize:48, marginBottom:16}}>ğŸ‹ï¸</div>
        <div style={{fontSize:26, fontWeight:900, color:"#ffffff", letterSpacing:"0.04em", marginBottom:8}}>
          PPL TRAINING
        </div>
        <div style={{fontSize:14, color:"#60a5fa", fontWeight:600, letterSpacing:"0.08em"}}>
          6-WEEK MESOCYCLE Â· KETO-OPTIMIZED
        </div>
        <div style={{marginTop:16, fontSize:13, color:"#64748b", lineHeight:1.6}}>
          Let's set up your profile before your first session.
        </div>
      </div>

      {/* Form */}
      <div style={{padding:"24px 20px 40px", flex:1, overflowY:"auto"}}>
        <div style={{marginBottom:20}}>
          <div style={labelStyle}>YOUR NAME *</div>
          <input
            type="text" placeholder="First name" value={form.name}
            onChange={e=>set("name", e.target.value)}
            style={inputStyle}
          />
        </div>

        <div style={{marginBottom:20}}>
          <div style={labelStyle}>GENDER *</div>
          <div style={{display:"grid", gridTemplateColumns:"1fr 1fr 1fr", gap:8, marginTop:8}}>
            {[["m","Male"],["f","Female"],["o","Other"]].map(([val, label]) => (
              <button key={val} onClick={()=>set("gender", val)} style={{
                padding:"14px 8px", borderRadius:10, cursor:"pointer", fontWeight:700, fontSize:14,
                background: form.gender===val ? "#1e3a5f" : "#0f1829",
                border:`1px solid ${form.gender===val ? "#3b82f6" : "#1e2d47"}`,
                color: form.gender===val ? "#60a5fa" : "#64748b",
                transition:"all 0.15s",
              }}>{label}</button>
            ))}
          </div>
        </div>

        <div style={{display:"grid", gridTemplateColumns:"1fr 1fr", gap:12, marginBottom:20}}>
          <div>
            <div style={labelStyle}>AGE</div>
            <input type="number" inputMode="numeric" placeholder="e.g. 35"
              value={form.age} onChange={e=>set("age", e.target.value)}
              style={inputStyle}
            />
          </div>
          <div>
            <div style={labelStyle}>WEIGHT (lbs)</div>
            <input type="number" inputMode="decimal" placeholder="e.g. 185"
              value={form.weight} onChange={e=>set("weight", e.target.value)}
              style={inputStyle}
            />
          </div>
        </div>

        <div style={{marginBottom:20}}>
          <div style={labelStyle}>MESO CYCLE LENGTH *</div>
          <div style={{display:"grid", gridTemplateColumns:"repeat(5,1fr)", gap:8, marginTop:8}}>
            {[4,6,8,10,12].map(n => (
              <button key={n} onClick={()=>set("mesoLength", n)} style={{
                padding:"12px 4px", borderRadius:10, cursor:"pointer", fontWeight:700, fontSize:14,
                background: form.mesoLength===n ? "#1e3a5f" : "#0f1829",
                border:`1px solid ${form.mesoLength===n ? "#3b82f6" : "#1e2d47"}`,
                color: form.mesoLength===n ? "#60a5fa" : "#64748b",
                transition:"all 0.15s",
              }}>{n}wk</button>
            ))}
          </div>
          <div style={{fontSize:11, color:"#4a6080", marginTop:8}}>
            {form.mesoLength === 4 && "Short & intense â€” great for a focused push."}
            {form.mesoLength === 6 && "Standard meso â€” the sweet spot for most trainees."}
            {form.mesoLength === 8 && "Extended accumulation â€” more volume base before peaking."}
            {form.mesoLength === 10 && "Advanced â€” high volume block with long intensification."}
            {form.mesoLength === 12 && "Full periodization â€” max accumulation, full peak. Commitment required."}
          </div>
        </div>

        <div style={{marginBottom:20}}>
          <div style={labelStyle}>DAYS PER WEEK *</div>
          <div style={{display:"grid", gridTemplateColumns:"1fr 1fr", gap:10, marginTop:8}}>
            {[[3,"3 Days / Week"],[6,"6 Days / Week"]].map(([n, label]) => (
              <button key={n} onClick={()=>set("daysPerWeek", n)} style={{
                padding:"16px 8px", borderRadius:10, cursor:"pointer", fontWeight:700, fontSize:14,
                background: form.daysPerWeek===n ? "#1e3a5f" : "#0f1829",
                border:`1px solid ${form.daysPerWeek===n ? "#3b82f6" : "#1e2d47"}`,
                color: form.daysPerWeek===n ? "#60a5fa" : "#64748b",
                transition:"all 0.15s",
              }}>{label}</button>
            ))}
          </div>
          <div style={{fontSize:11, color:"#4a6080", marginTop:8, lineHeight:1.6}}>
            {form.daysPerWeek === 3
              ? "Push Â· Pull Â· Legs once per week. Each muscle group trained once. Best for busy schedules or new trainees."
              : "Full PPL Ã—2 â€” Push Â· Pull Â· Legs twice per week. Each muscle group hit twice. Optimal for strength and hypertrophy."}
          </div>
        </div>

        <div style={{marginBottom:28}}>
          <div style={labelStyle}>YOUR GOAL FOR THIS MESO</div>
          <textarea
            placeholder="e.g. Hit single digit body fat, add 10 lbs to my squat, stay consistent..."
            value={form.goal} onChange={e=>set("goal", e.target.value)}
            style={{...inputStyle, minHeight:90, resize:"vertical", lineHeight:1.6}}
          />
        </div>

        {error && (
          <div style={{
            background:"#2d0f0f", border:"1px solid #ef4444", borderRadius:10,
            padding:"12px 14px", marginBottom:16, fontSize:13, color:"#f87171",
          }}>{error}</div>
        )}

        <button onClick={handleSubmit} style={{
          width:"100%", padding:"20px", borderRadius:12, cursor:"pointer",
          background:"linear-gradient(135deg, #1d4ed8 0%, #2563eb 100%)",
          border:"1px solid #3b82f6", color:"#fff",
          fontSize:17, fontWeight:900, letterSpacing:"0.06em",
          boxShadow:"0 4px 24px rgba(59,130,246,0.4)",
        }}>
          LET'S GET IT ğŸ”¥
        </button>
      </div>
    </div>
  );
}

// â”€â”€â”€ READY DIALOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ReadyDialog({ dayLabel, userName, isDone, onYes, onNo }) {
  const greetings = [
    "Time to earn it.",
    "No shortcuts. No excuses.",
    "The bar is waiting.",
    "This is where it happens.",
    "Show up and show out.",
    "Another day, another W.",
    "Champions are built in sessions like this.",
    "Lock in. Let's work.",
  ];
  const [msg] = useState(() => greetings[Math.floor(Math.random() * greetings.length)]);

  if (isDone) {
    return (
      <div style={{
        position:"fixed", inset:0, zIndex:250,
        background:"rgba(0,0,0,0.85)", backdropFilter:"blur(6px)",
        display:"flex", alignItems:"center", justifyContent:"center", padding:24,
      }}>
        <div style={{
          background:"linear-gradient(145deg, #0d1829 0%, #0a1520 100%)",
          border:"1px solid #166534", borderRadius:20,
          padding:"32px 24px", maxWidth:340, width:"100%",
          boxShadow:"0 24px 60px rgba(0,0,0,0.7)",
          animation:"dialogIn 0.2s cubic-bezier(0.34,1.56,0.64,1)",
          textAlign:"center",
        }}>
          <div style={{fontSize:44, marginBottom:14}}>âœ…</div>
          <div style={{fontSize:11, fontWeight:700, letterSpacing:"0.16em", color:"#22c55e", marginBottom:8}}>
            {dayLabel.toUpperCase()}
          </div>
          <div style={{fontSize:20, fontWeight:900, color:"#ffffff", marginBottom:10, lineHeight:1.3}}>
            This session is already complete.
          </div>
          <div style={{fontSize:13, color:"#94a3b8", marginBottom:28, lineHeight:1.6}}>
            Would you like to review your logged weights? You can still update your session notes, but weights and reps are locked.
          </div>
          <div style={{display:"grid", gridTemplateColumns:"1fr 1fr", gap:12}}>
            <button onClick={onNo} style={{
              padding:"15px", borderRadius:12, cursor:"pointer",
              background:"transparent", border:"1px solid #1e2d47",
              color:"#64748b", fontSize:15, fontWeight:700,
            }}>GO BACK</button>
            <button onClick={onYes} style={{
              padding:"15px", borderRadius:12, cursor:"pointer",
              background:"#052e16", border:"1px solid #166534",
              color:"#22c55e", fontSize:15, fontWeight:800,
            }}>REVIEW</button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div style={{
      position:"fixed", inset:0, zIndex:250,
      background:"rgba(0,0,0,0.85)", backdropFilter:"blur(6px)",
      display:"flex", alignItems:"center", justifyContent:"center", padding:24,
    }}>
      <div style={{
        background:"linear-gradient(145deg, #0d1829 0%, #0a1520 100%)",
        border:"1px solid #1e3a5f", borderRadius:20,
        padding:"32px 24px", maxWidth:340, width:"100%",
        boxShadow:"0 24px 60px rgba(0,0,0,0.7)",
        animation:"dialogIn 0.2s cubic-bezier(0.34,1.56,0.64,1)",
        textAlign:"center",
      }}>
        <div style={{fontSize:44, marginBottom:14}}>ğŸ’ª</div>
        <div style={{fontSize:11, fontWeight:700, letterSpacing:"0.16em", color:"#60a5fa", marginBottom:8}}>
          {dayLabel.toUpperCase()}
        </div>
        <div style={{fontSize:20, fontWeight:900, color:"#ffffff", marginBottom:10, lineHeight:1.3}}>
          Are you ready to get after it{userName ? `, ${userName}` : ""}?
        </div>
        <div style={{fontSize:13, color:"#93c5fd", marginBottom:28, lineHeight:1.6}}>
          {msg}
        </div>
        <div style={{display:"grid", gridTemplateColumns:"1fr 1fr", gap:12}}>
          <button onClick={onNo} style={{
            padding:"15px", borderRadius:12, cursor:"pointer",
            background:"transparent", border:"1px solid #1e2d47",
            color:"#64748b", fontSize:15, fontWeight:700,
          }}>NOT YET</button>
          <button onClick={onYes} style={{
            padding:"15px", borderRadius:12, cursor:"pointer",
            background:"linear-gradient(135deg, #1d4ed8 0%, #2563eb 100%)",
            border:"1px solid #3b82f6",
            color:"#fff", fontSize:15, fontWeight:800,
            boxShadow:"0 4px 16px rgba(59,130,246,0.3)",
          }}>LET'S GO!</button>
        </div>
      </div>
    </div>
  );
}

// â”€â”€â”€ WORKOUT COMPLETE MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function WorkoutCompleteModal({ dayLabel, gender, onOk }) {
  const [congrats] = useState(randomCongrats);
  const [quote] = useState(() => randomQuote(gender));

  return (
    <div style={{
      position:"fixed", inset:0, zIndex:300,
      background:"rgba(0,0,0,0.88)", backdropFilter:"blur(8px)",
      display:"flex", alignItems:"center", justifyContent:"center", padding:20,
      overflowY:"auto",
    }}>
      <div style={{
        background:"linear-gradient(145deg, #0d1829 0%, #0a1520 100%)",
        border:"1px solid #1e3a5f",
        borderRadius:20, padding:"28px 22px 24px", maxWidth:360, width:"100%",
        boxShadow:"0 32px 80px rgba(0,0,0,0.8), 0 0 0 1px rgba(96,165,250,0.1)",
        animation:"modalIn 0.25s cubic-bezier(0.34,1.56,0.64,1)",
        margin:"auto",
      }}>
        {/* Congrats section */}
        <div style={{textAlign:"center", marginBottom:22}}>
          <div style={{fontSize:46, marginBottom:10, filter:"drop-shadow(0 0 20px rgba(96,165,250,0.4))"}}>
            {congrats.emoji}
          </div>
          <div style={{
            fontSize:21, fontWeight:900, color:"#ffffff",
            letterSpacing:"0.06em", marginBottom:8, lineHeight:1.2,
          }}>
            {congrats.headline}
          </div>
          <div style={{fontSize:13, color:"#93c5fd", lineHeight:1.6, padding:"0 4px"}}>
            {congrats.sub}
          </div>
        </div>

        {/* Divider */}
        <div style={{borderTop:"1px solid #1e3a5f", margin:"0 -4px 20px"}} />

        {/* Quote section */}
        <div style={{
          background:"#080e1a", borderRadius:12, padding:"16px 14px",
          border:"1px solid #1a2e4a", marginBottom:20,
        }}>
          <div style={{
            fontSize:10, fontWeight:700, letterSpacing:"0.18em",
            color:"#f59e0b", marginBottom:10,
          }}>
            TODAY'S QUOTE OF THE DAY
          </div>
          <div style={{fontSize:13, color:"#e2e8f0", lineHeight:1.7, fontStyle:"italic", marginBottom:8}}>
            "{quote.text}"
          </div>
          <div style={{fontSize:12, fontWeight:700, color:"#60a5fa", textAlign:"right"}}>
            â€” {quote.author}
          </div>
        </div>

        {/* OK button */}
        <button onClick={onOk} style={{
          width:"100%", padding:"18px", borderRadius:12, cursor:"pointer",
          background:"linear-gradient(135deg, #1d4ed8 0%, #2563eb 100%)",
          border:"1px solid #3b82f6",
          color:"#ffffff", fontSize:16, fontWeight:800,
          letterSpacing:"0.08em",
          boxShadow:"0 4px 20px rgba(59,130,246,0.35)",
          WebkitAppearance:"none",
          touchAction:"manipulation",
        }}>
          OK â€” NEXT SESSION â†’
        </button>
      </div>
      <style>{`@keyframes modalIn { from { opacity:0; transform:scale(0.88) translateY(20px); } to { opacity:1; transform:scale(1) translateY(0); } }`}</style>
    </div>
  );
}

// â”€â”€â”€ COMPLETE EXERCISE DIALOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function CompleteDialog({ exerciseName, onYes, onNo }) {
  return (
    <div style={{
      position:"fixed", inset:0, zIndex:200,
      background:"rgba(0,0,0,0.8)", backdropFilter:"blur(6px)",
      display:"flex", alignItems:"center", justifyContent:"center", padding:24,
    }}>
      <div style={{
        background:"#0f1829", border:"1px solid #1e3a5f", borderRadius:18,
        padding:"32px 24px", maxWidth:340, width:"100%",
        boxShadow:"0 24px 60px rgba(0,0,0,0.7)",
        animation:"dialogIn 0.18s ease-out",
      }}>
        <div style={{textAlign:"center", marginBottom:24}}>
          <div style={{fontSize:38, marginBottom:14}}>âœ…</div>
          <div style={{fontSize:12, fontWeight:700, letterSpacing:"0.15em", color:"#60a5fa", marginBottom:10}}>EXERCISE COMPLETE?</div>
          <div style={{fontSize:18, fontWeight:800, color:"#e2e8f0", lineHeight:1.4}}>{exerciseName}</div>
          <div style={{fontSize:14, color:"#94a3b8", marginTop:10, lineHeight:1.5}}>All sets logged. Mark complete and move to the next exercise?</div>
        </div>
        <div style={{display:"grid", gridTemplateColumns:"1fr 1fr", gap:12}}>
          <button onClick={onNo} style={{
            padding:"16px", borderRadius:12, cursor:"pointer",
            background:"transparent", border:"1px solid #1e2d47",
            color:"#64748b", fontSize:16, fontWeight:700,
          }}>NO</button>
          <button onClick={onYes} style={{
            padding:"16px", borderRadius:12, cursor:"pointer",
            background:"#1e3a5f", border:"1px solid #3b82f6",
            color:"#60a5fa", fontSize:16, fontWeight:800,
          }}>YES</button>
        </div>
      </div>
      <style>{`@keyframes dialogIn { from { opacity:0; transform:scale(0.9) translateY(16px); } to { opacity:1; transform:scale(1) translateY(0); } }`}</style>
    </div>
  );
}

// â”€â”€â”€ EXERCISE CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ExerciseCard({ exercise, exIdx, weekIdx, weekData, onUpdateSet, onWeightAutoFill, onLastSetFilled, expanded, onToggle, done, readOnly }) {
  const goal = PROG_TARGETS[exercise.progression][weekIdx];
  const goalColor = weekIdx < 2 ? "#64748b" : weekIdx < 4 ? "#22c55e" : weekIdx < 5 ? "#f59e0b" : "#ef4444";

  const handleWeightBlur = (s, value) => {
    if (s === 0 && value.trim() !== "" && !isNaN(parseFloat(value))) {
      onWeightAutoFill(exIdx, value, exercise.sets);
    }
  };

  const handleRepsChange = (s, value) => {
    onUpdateSet(exIdx, s, "reps", value);
    // Trigger immediately on last set when a valid positive number is entered
    if (s === exercise.sets - 1 && value.trim() !== "" && parseFloat(value) > 0) {
      onLastSetFilled(exIdx, exercise.name);
    }
  };

  const handleRepsBlur = (s, value) => {
    // Fallback: also catch on blur in case onChange fires before state updates settle
    if (s === exercise.sets - 1 && value.trim() !== "" && parseFloat(value) > 0) {
      onLastSetFilled(exIdx, exercise.name);
    }
  };

  return (
    <div style={{borderBottom:"1px solid #111827", opacity: done ? 0.5 : 1, transition:"opacity 0.3s"}}>
      <button onClick={onToggle} style={{
        width:"100%", textAlign:"left", padding:"16px",
        background:"transparent", border:"none", cursor:"pointer",
        display:"flex", alignItems:"flex-start", gap:12,
      }}>
        {exercise.anchor && <span style={{fontSize:18, marginTop:1, flexShrink:0}}>â­</span>}
        <div style={{flex:1, minWidth:0}}>
          <div style={{display:"flex", alignItems:"baseline", gap:8, flexWrap:"wrap"}}>
            <div style={{fontSize:20, fontWeight:700, color: done ? "#4a6080" : "#e2e8f0", lineHeight:1.3}}>{exercise.name}</div>
            {exercise.muscle && (
              <span style={{fontSize:11, color:"#f59e0b", fontWeight:700, letterSpacing:"0.05em"}}>
                {exercise.muscle.toUpperCase()}
              </span>
            )}
            {done && <span style={{fontSize:14, color:"#22c55e"}}>âœ“</span>}
          </div>
          <div style={{marginTop:8, display:"flex", flexWrap:"wrap", gap:6}}>
            {pill("#60a5fa", `${exercise.sets} Ã— ${exercise.reps}`)}
            <span style={{
              display:"inline-flex", alignItems:"center", padding:"4px 10px",
              borderRadius:99, background:"#1a3a2a", color:"#4ade80",
              fontSize:12, fontWeight:700, letterSpacing:"0.04em"
            }}>â± {exercise.rest}</span>
            <span style={{
              display:"inline-flex", alignItems:"center", padding:"4px 10px",
              borderRadius:99, background:"#2a1f0a", color:"#fbbf24",
              fontSize:12, fontWeight:700, letterSpacing:"0.04em"
            }}>â†‘ {goal}</span>
          </div>
        </div>
        <span style={{
          color:"#334155", fontSize:22, flexShrink:0,
          transform: expanded ? "rotate(90deg)" : "none", transition:"transform 0.2s",
          marginTop:2,
        }}>â€º</span>
      </button>

      {expanded && (
        <div style={{background:"#080c18", borderTop:"1px solid #1e2d47"}}>
          <div style={{display:"grid", gridTemplateColumns:"40px 1fr 1fr", gap:8, padding:"10px 16px 8px", borderBottom:"1px solid #111827"}}>
            <span style={{fontSize:11, color:"#334155", fontWeight:700, textAlign:"center"}}>SET</span>
            <span style={{fontSize:11, color:"#334155", fontWeight:700, textAlign:"center"}}>WEIGHT (lbs)</span>
            <span style={{fontSize:11, color:"#334155", fontWeight:700, textAlign:"center"}}>REPS</span>
          </div>
          {Array.from({length:exercise.sets}, (_,s) => {
            const setData = (weekData[exIdx] || {})[s] || {weight:"", reps:""};
            return (
              <div key={s} style={{display:"grid", gridTemplateColumns:"40px 1fr 1fr", gap:8, padding:"6px 16px", borderBottom:"1px solid #0d1220", alignItems:"center"}}>
                <span style={{fontSize:16, fontWeight:800, color:"#334a6b", textAlign:"center"}}>{s+1}</span>
                <input type="number" inputMode="decimal" placeholder="0"
                  value={setData.weight}
                  onChange={e=> !readOnly && onUpdateSet(exIdx, s, "weight", e.target.value)}
                  onBlur={e=> !readOnly && handleWeightBlur(s, e.target.value)}
                  readOnly={readOnly}
                  style={{
                    background: readOnly ? "#080c18" : "#0f1829",
                    border:"1px solid #1e2d47", borderRadius:10,
                    color:"#60a5fa", fontSize:20, fontWeight:700, padding:"13px 8px",
                    textAlign:"center", width:"100%", outline:"none",
                    opacity: readOnly ? 0.7 : 1,
                  }}
                />
                <input type="number" inputMode="numeric" placeholder="0"
                  value={setData.reps}
                  onChange={e=> !readOnly && handleRepsChange(s, e.target.value)}
                  onBlur={e=> !readOnly && handleRepsBlur(s, e.target.value)}
                  readOnly={readOnly}
                  style={{
                    background: readOnly ? "#080c18" : "#0f1829",
                    border:"1px solid #1e2d47", borderRadius:10,
                    color:"#34d399", fontSize:20, fontWeight:700, padding:"13px 8px",
                    textAlign:"center", width:"100%", outline:"none",
                    opacity: readOnly ? 0.7 : 1,
                  }}
                />
              </div>
            );
          })}
          <div style={{padding:"10px 16px", display:"flex", gap:8, alignItems:"center"}}>
            <span style={{fontSize:11, color:"#94a3b8", fontWeight:700}}>WARM-UP:</span>
            <span style={{fontSize:11, color:"#94a3b8"}}>{exercise.warmup}</span>
          </div>
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€ DAY VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function DayView({ dayIdx, weekIdx, onBack, onComplete, onNextDay, completedDays, profile }) {
  const day = DAYS[dayIdx];
  const accent = TAG_ACCENT[day.tag];
  const pc = PHASE_COLOR[WEEK_PHASE[weekIdx]];
  const isDone = completedDays.has(`${dayIdx}:${weekIdx}`);

  const [weekData, setWeekData]           = useState(() => loadDayWeekWithCarryover(dayIdx, weekIdx, day));
  const [notes, setNotes]                 = useState(() => loadNotes(dayIdx, weekIdx));
  const [expandedIdx, setExpandedIdx]     = useState(0);
  const [doneExercises, setDoneExercises] = useState(new Set());
  const [dialog, setDialog]               = useState(null);
  const [showWorkoutModal, setShowWorkoutModal] = useState(false);
  const [showReadyDialog, setShowReadyDialog]   = useState(true);
  const dialogShownRef = React.useRef(new Set());

  const handleUpdateSet = useCallback((exIdx, setIdx, field, value) => {
    // If user edits data for a done exercise, un-done it so they can re-complete
    setDoneExercises(prev => {
      if (prev.has(exIdx)) {
        const next = new Set(prev);
        next.delete(exIdx);
        return next;
      }
      return prev;
    });
    // Allow dialog to fire again for this exercise after an edit
    dialogShownRef.current.delete(exIdx);

    setWeekData(prev => {
      const next = {
        ...prev,
        [exIdx]: {
          ...(prev[exIdx] || {}),
          [setIdx]: {...((prev[exIdx] || {})[setIdx] || {}), [field]: value}
        }
      };
      saveDayWeek(dayIdx, weekIdx, next);
      return next;
    });
  }, [dayIdx, weekIdx]);

  const handleWeightAutoFill = useCallback((exIdx, weight, numSets) => {
    setWeekData(prev => {
      const exData = prev[exIdx] || {};
      const next = { ...prev, [exIdx]: { ...exData } };
      for (let s = 1; s < numSets; s++) {
        const existing = (exData[s] || {}).weight;
        if (!existing || existing === "") {
          next[exIdx][s] = { ...(exData[s] || {}), weight };
        }
      }
      saveDayWeek(dayIdx, weekIdx, next);
      return next;
    });
  }, [dayIdx, weekIdx]);

  const handleLastSetFilled = useCallback((exIdx, exName) => {
    // Don't fire if already done or already shown since last edit
    if (doneExercises.has(exIdx) || dialogShownRef.current.has(exIdx)) return;
    dialogShownRef.current.add(exIdx);
    setDialog({ exIdx, exName });
  }, [doneExercises]);

  const handleDialogYes = () => {
    const { exIdx } = dialog;
    setDialog(null);
    setDoneExercises(prev => new Set([...prev, exIdx]));
    const nextIdx = exIdx + 1;
    if (nextIdx < day.exercises.length) {
      setExpandedIdx(nextIdx);
      setTimeout(() => {
        const el = document.getElementById(`ex-${nextIdx}`);
        if (el) el.scrollIntoView({ behavior:"smooth", block:"start" });
      }, 120);
    } else {
      setExpandedIdx(null);
    }
  };

  const handleDialogNo = () => setDialog(null);

  const handleNoteChange = (val) => {
    setNotes(val);
    saveNotes(dayIdx, weekIdx, val);
  };

  const handleComplete = () => {
    markComplete(dayIdx, weekIdx);
    onComplete(dayIdx, weekIdx);
    setShowWorkoutModal(true);
  };

  return (
    <div style={{paddingBottom:100}}>
      {showReadyDialog && (
        <ReadyDialog
          dayLabel={day.label}
          userName={profile?.name || ""}
          isDone={isDone}
          onYes={() => setShowReadyDialog(false)}
          onNo={onBack}
        />
      )}
      {showWorkoutModal && (
        <WorkoutCompleteModal
          dayLabel={day.label}
          gender={profile?.gender}
          onOk={() => { setShowWorkoutModal(false); window.scrollTo(0,0); onBack(); }}
        />
      )}
      {dialog && (
        <CompleteDialog exerciseName={dialog.exName} onYes={handleDialogYes} onNo={handleDialogNo} />
      )}

      {/* Day header */}
      <div style={{background:"#0d1220", borderBottom:"1px solid #1e2d47", padding:"14px 16px"}}>
        <button onClick={onBack} style={{background:"none", border:"none", color:"#60a5fa", fontSize:15, cursor:"pointer", padding:"0 0 12px", display:"flex", alignItems:"center", gap:6}}>
          â€¹ Back
        </button>
        <div style={{display:"flex", alignItems:"flex-start", justifyContent:"space-between", gap:8}}>
          <div style={{flex:1}}>
            <div style={{display:"flex", alignItems:"center", flexWrap:"wrap", gap:6, marginBottom:8}}>
              {pill(accent, day.tag)}
              {pill(pc, `W${weekIdx+1} Â· ${WEEK_RIR[weekIdx]}`)}
              {isDone && pill("#22c55e", "âœ“ Done")}
            </div>
            <div style={{fontSize:21, fontWeight:800, color:"#e2e8f0"}}>{day.label}</div>
            <div style={{fontSize:13, color:"#94a3b8", marginTop:3}}>{day.muscles}</div>
          </div>
        </div>
        {day.cardio && (
          <div style={{marginTop:12, padding:"10px 12px", background:"#1e2d47", borderRadius:10, display:"flex", alignItems:"center", gap:8}}>
            <span>ğŸƒ</span>
            <span style={{fontSize:13, color:"#60a5fa", fontWeight:700}}>{day.cardio} Â· Norwegian 4x4 â€” PM session</span>
          </div>
        )}
        <div style={{marginTop:10, padding:"10px 14px", background:"#0a0e1a", borderRadius:10, borderLeft:`3px solid ${accent}`}}>
          <span style={{fontSize:13, color:"#94a3b8", lineHeight:1.6}}>{day.note}</span>
        </div>
      </div>

      {/* Exercises */}
      <div style={{margin:"16px 16px 0", background:"#0f1829", border:"1px solid #1e2d47", borderRadius:12, overflow:"hidden"}}>
        <div style={{padding:"12px 16px", borderBottom:"1px solid #1e2d47", background:"#080c18", display:"flex", justifyContent:"space-between", alignItems:"center"}}>
          <span style={{fontSize:12, fontWeight:700, letterSpacing:"0.12em", color:"#60a5fa"}}>EXERCISES</span>
          <span style={{fontSize:12, color:"#334155"}}>{doneExercises.size}/{day.exercises.length} done</span>
        </div>
        {day.exercises.map((ex, i) => (
          <div key={i} id={`ex-${i}`}>
            <ExerciseCard
              exercise={ex}
              exIdx={i}
              weekIdx={weekIdx}
              weekData={weekData}
              onUpdateSet={handleUpdateSet}
              onWeightAutoFill={handleWeightAutoFill}
              onLastSetFilled={handleLastSetFilled}
              expanded={expandedIdx === i}
              onToggle={() => setExpandedIdx(expandedIdx === i ? null : i)}
              done={doneExercises.has(i)}
              readOnly={isDone}
            />
          </div>
        ))}
      </div>

      {/* Notes */}
      <div style={{margin:"16px 16px 0"}}>
        <div style={{fontSize:12, fontWeight:700, letterSpacing:"0.12em", color:"#94a3b8", marginBottom:8, display:"flex", alignItems:"center", justifyContent:"space-between"}}>
          SESSION NOTES
          {isDone && <span style={{fontSize:11, color:"#4ade80", fontWeight:600, letterSpacing:"0.04em"}}>âœ editable</span>}
        </div>
        <textarea
          value={notes}
          onChange={e=>handleNoteChange(e.target.value)}
          placeholder="How'd it feel? Any PRs? Notes for next session..."
          style={{
            width:"100%", minHeight:100,
            background:"#0f1829", border:"1px solid #1e2d47", borderRadius:10,
            color:"#94a3b8", fontSize:14, padding:"14px", resize:"vertical",
            outline:"none", lineHeight:1.6,
          }}
        />
      </div>

      {/* Complete button or read-only banner */}
      <div style={{margin:"16px 16px 0"}}>
        {isDone ? (
          <div style={{
            width:"100%", padding:"18px", borderRadius:12,
            background:"#052e16", border:"1px solid #166534",
            color:"#22c55e", fontSize:15, fontWeight:700,
            textAlign:"center", letterSpacing:"0.04em", lineHeight:1.5,
          }}>
            âœ“ Session Complete â€” Review Only
            <div style={{fontSize:12, color:"#4ade8088", marginTop:4, fontWeight:400}}>
              Changes are not allowed for completed sessions
            </div>
          </div>
        ) : (
          <button onClick={handleComplete} style={{
            width:"100%", padding:"18px", borderRadius:12,
            background:accent, border:`1px solid ${accent}`,
            color:"#fff", fontSize:16, fontWeight:800, cursor:"pointer", letterSpacing:"0.05em",
          }}>
            Mark Session Complete
          </button>
        )}
      </div>
    </div>
  );
}

// â”€â”€â”€ PROGRESS VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ProgressView({ currentWeek, completedDays }) {
  const [expandedDay, setExpandedDay] = useState(null);
  // Tally sets per muscle group across completed sessions in current week
  const muscleGroups = { PUSH: 0, PULL: 0, LEGS: 0 };
  ACTIVE_DAYS.forEach((day, dayIdx) => {
    if (!completedDays.has(`${dayIdx}:${currentWeek}`)) return;
    const weekData = loadDayWeek(dayIdx, currentWeek);
    day.exercises.forEach((ex, exIdx) => {
      const exData = weekData[exIdx] || {};
      const filledSets = Object.values(exData).filter(s => s.reps && s.reps !== "").length;
      if (filledSets > 0) muscleGroups[day.tag] += filledSets;
    });
  });

  const workoutsThisWeek = ACTIVE_DAYS.filter((_, i) => completedDays.has(`${i}:${currentWeek}`)).length;
  const workoutsTotal    = Array.from(completedDays).length;

  // Current weights â€” latest logged weight for each anchor lift across all weeks
  const anchorLifts = ACTIVE_DAYS.map(day => {
    const anchor = day.exercises.find(e => e.anchor);
    if (!anchor) return null;
    let bestWeight = "";
    // Scan weeks from newest to oldest for most recent logged weight
    for (let w = currentWeek; w >= 0; w--) {
      const wd = loadDayWeek(ACTIVE_DAYS.indexOf(day), w);
      for (let s = 0; s < anchor.sets; s++) {
        const wt = (wd[0] || {})[s]?.weight || (wd[0] || {}).weight;
        // Get set 0 weight from exercise index 0
        const exData = wd[0] || {};
        // find first set with weight
        const setWithWeight = Object.values(wd[0] || {}).find(sv => sv.weight && sv.weight !== "");
        if (setWithWeight) { bestWeight = setWithWeight.weight; break; }
      }
      if (bestWeight) break;
    }
    return { name: anchor.name, tag: day.tag, weight: bestWeight };
  }).filter(Boolean);

  // All exercises current weight (first set logged, most recent week)
  const allLifts = [];
  ACTIVE_DAYS.forEach((day, dayIdx) => {
    day.exercises.forEach((ex, exIdx) => {
      let weight = "";
      for (let w = currentWeek; w >= 0; w--) {
        const wd = loadDayWeek(dayIdx, w);
        const exData = wd[exIdx] || {};
        const setWithWeight = Object.values(exData).find(sv => sv && sv.weight && sv.weight !== "");
        if (setWithWeight) { weight = setWithWeight.weight; break; }
      }
      allLifts.push({ name: ex.name, tag: day.tag, weight, anchor: ex.anchor });
    });
  });

  const tagColor = TAG_ACCENT;
  const phase = WEEK_PHASE[currentWeek];
  const pc = PHASE_COLOR[phase];

  const statBox = (label, value, color) => (
    <div style={{
      flex:1, background:"#0f1829", border:`1px solid ${color}33`,
      borderRadius:12, padding:"14px 12px", textAlign:"center",
    }}>
      <div style={{fontSize:22, fontWeight:900, color}}>{value}</div>
      <div style={{fontSize:10, color:"#94a3b8", marginTop:4, fontWeight:700, letterSpacing:"0.08em"}}>{label}</div>
    </div>
  );

  return (
    <div style={{padding:"0 16px 24px"}}>
      {/* Week summary stats */}
      <div style={{marginBottom:16}}>
        <div style={{fontSize:11, fontWeight:700, letterSpacing:"0.12em", color:"#60a5fa", marginBottom:10}}>
          WEEK {currentWeek + 1} SUMMARY Â· {phase.toUpperCase()}
        </div>
        <div style={{display:"flex", gap:10, marginBottom:10}}>
          {statBox("THIS WEEK", `${workoutsThisWeek}/6`, pc)}
          {statBox("TOTAL SESSIONS", workoutsTotal, "#60a5fa")}
        </div>
        <div style={{display:"flex", gap:10}}>
          {statBox("PUSH SETS", muscleGroups.PUSH, TAG_ACCENT.PUSH)}
          {statBox("PULL SETS", muscleGroups.PULL, TAG_ACCENT.PULL)}
          {statBox("LEG SETS",  muscleGroups.LEGS,  TAG_ACCENT.LEGS)}
        </div>
      </div>

      {/* Lift weights by day */}
      {ACTIVE_DAYS.map((day, dayIdx) => {
        const accent = TAG_ACCENT[day.tag];
        const dayLiftsDirect = day.exercises.map((ex, exIdx) => {
          let weight = "";
          for (let w = currentWeek; w >= 0; w--) {
            const wd = loadDayWeek(dayIdx, w);
            const exData = wd[exIdx] || {};
            const sw = Object.values(exData).find(sv => sv && sv.weight && sv.weight !== "");
            if (sw) { weight = sw.weight; break; }
          }
          return { name: ex.name, muscle: ex.muscle, weight, anchor: ex.anchor, sets: ex.sets, reps: ex.reps };
        });
        const anyLogged = dayLiftsDirect.some(l => l.weight);
        const isDayExpanded = expandedDay === dayIdx;
        return (
          <div key={dayIdx} style={{
            background:"#0f1829", border:`1px solid ${anyLogged ? accent+"44" : "#1e2d47"}`,
            borderRadius:12, marginBottom:10, overflow:"hidden",
          }}>
            <button onClick={()=>setExpandedDay(isDayExpanded ? null : dayIdx)} style={{
              width:"100%", textAlign:"left",
              background: anyLogged ? accent+"11" : "#080c18",
              border:"none", borderBottom: isDayExpanded ? "1px solid #111827" : "none",
              padding:"12px 14px", cursor:"pointer",
              display:"flex", alignItems:"center", gap:10,
            }}>
              <span style={{
                background:accent+"22", color:accent, fontSize:10, fontWeight:800,
                padding:"3px 8px", borderRadius:6, letterSpacing:"0.06em", flexShrink:0,
              }}>{day.tag}</span>
              <span style={{fontSize:13, fontWeight:700, color:"#e2e8f0", flex:1}}>Day {day.dayNum} â€” {day.label}</span>
              {completedDays.has(`${dayIdx}:${currentWeek}`) && (
                <span style={{fontSize:12, color:"#22c55e", flexShrink:0}}>âœ“</span>
              )}
              <span style={{
                color:"#334155", fontSize:20, flexShrink:0,
                transform: isDayExpanded ? "rotate(90deg)" : "none", transition:"transform 0.2s",
              }}>â€º</span>
            </button>
            {isDayExpanded && (
              <div>
                {dayLiftsDirect.map((lift, i) => (
                  <div key={i} style={{
                    display:"flex", alignItems:"center", justifyContent:"space-between",
                    padding:"10px 14px", borderBottom: i < dayLiftsDirect.length-1 ? "1px solid #0d1220" : "none",
                  }}>
                    <div style={{flex:1, minWidth:0}}>
                      <div style={{display:"flex", alignItems:"baseline", gap:7, flexWrap:"wrap"}}>
                        <span style={{fontSize:13, color:"#e2e8f0", fontWeight:600}}>
                          {lift.anchor && "â­ "}{lift.name}
                        </span>
                        {lift.muscle && (
                          <span style={{fontSize:10, color:"#f59e0b", fontWeight:700, letterSpacing:"0.05em"}}>
                            {lift.muscle.toUpperCase()}
                          </span>
                        )}
                      </div>
                      <span style={{fontSize:11, color:"#334a6b"}}>{lift.sets}Ã—{lift.reps}</span>
                    </div>
                    <div style={{
                      fontSize:14, fontWeight:800, color: lift.weight ? "#60a5fa" : "#334155",
                      minWidth:60, textAlign:"right",
                    }}>
                      {lift.weight ? `${lift.weight} lbs` : "â€”"}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        );
      })}
    </div>
  );
}

// â”€â”€â”€ RESET CONFIRM DIALOGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ResetDialog({ onConfirmed, onCancel }) {
  const [step, setStep] = useState(1); // 1 = "are you sure", 2 = "confirm/cancel"
  return (
    <div style={{
      position:"fixed", inset:0, zIndex:300,
      background:"rgba(0,0,0,0.85)", backdropFilter:"blur(6px)",
      display:"flex", alignItems:"center", justifyContent:"center", padding:24,
    }}>
      <div style={{
        background:"#0f1829", border:"1px solid #ef4444",
        borderRadius:20, padding:"30px 24px", maxWidth:340, width:"100%",
        boxShadow:"0 24px 60px rgba(239,68,68,0.2)",
        animation:"dialogIn 0.2s cubic-bezier(0.34,1.56,0.64,1)",
        textAlign:"center",
      }}>
        {step === 1 ? <>
          <div style={{fontSize:36, marginBottom:14}}>âš ï¸</div>
          <div style={{fontSize:18, fontWeight:900, color:"#f87171", marginBottom:10}}>
            RESET ENTIRE MESO?
          </div>
          <div style={{fontSize:13, color:"#94a3b8", lineHeight:1.7, marginBottom:28}}>
            This will permanently erase all logged weights, reps, session completions, and notes across all 7 weeks. This cannot be undone.
          </div>
          <div style={{display:"grid", gridTemplateColumns:"1fr 1fr", gap:12}}>
            <button onClick={onCancel} style={{
              padding:"15px", borderRadius:12, cursor:"pointer",
              background:"transparent", border:"1px solid #1e2d47",
              color:"#94a3b8", fontSize:15, fontWeight:700,
            }}>NO</button>
            <button onClick={()=>setStep(2)} style={{
              padding:"15px", borderRadius:12, cursor:"pointer",
              background:"#2d0f0f", border:"1px solid #ef4444",
              color:"#f87171", fontSize:15, fontWeight:800,
            }}>YES</button>
          </div>
        </> : <>
          <div style={{fontSize:36, marginBottom:14}}>ğŸ”´</div>
          <div style={{fontSize:18, fontWeight:900, color:"#f87171", marginBottom:10}}>
            LAST CHANCE
          </div>
          <div style={{fontSize:13, color:"#94a3b8", lineHeight:1.7, marginBottom:28}}>
            Are you absolutely sure? All data will be permanently wiped and you'll start back at Week 1.
          </div>
          <div style={{display:"grid", gridTemplateColumns:"1fr 1fr", gap:12}}>
            <button onClick={onCancel} style={{
              padding:"15px", borderRadius:12, cursor:"pointer",
              background:"transparent", border:"1px solid #1e2d47",
              color:"#94a3b8", fontSize:15, fontWeight:700,
            }}>CANCEL</button>
            <button onClick={onConfirmed} style={{
              padding:"15px", borderRadius:12, cursor:"pointer",
              background:"#7f1d1d", border:"1px solid #ef4444",
              color:"#fca5a5", fontSize:15, fontWeight:800,
            }}>CONFIRM RESET</button>
          </div>
        </>}
      </div>
    </div>
  );
}

// â”€â”€â”€ WEEK SECTION (nested days) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function WeekSection({ weekIdx, currentWeek, onSelectDay, completedDays, isExpanded, onToggle }) {
  const phase = WEEK_PHASE[weekIdx];
  const pc = PHASE_COLOR[phase];
  const rir = WEEK_RIR[weekIdx];
  const isCurrent = weekIdx === currentWeek;
  const weekDone = ACTIVE_DAYS.filter((_, i) => completedDays.has(`${i}:${weekIdx}`)).length;

  return (
    <div style={{marginBottom:8}}>
      <button onClick={onToggle} style={{
        width:"100%", textAlign:"left",
        background: isCurrent ? pc+"18" : "#0d1220",
        border:`1px solid ${isCurrent ? pc : "#1e2d47"}`,
        borderRadius: isExpanded ? "12px 12px 0 0" : 12,
        padding:"14px 16px", cursor:"pointer",
        display:"flex", alignItems:"center", gap:12, transition:"all 0.15s",
      }}>
        <div style={{
          width:46, height:46, borderRadius:10, flexShrink:0,
          background: pc+"22", display:"flex", flexDirection:"column",
          alignItems:"center", justifyContent:"center",
        }}>
          <span style={{fontSize:16, fontWeight:800, color:pc}}>W{weekIdx+1}</span>
        </div>
        <div style={{flex:1, minWidth:0}}>
          <div style={{display:"flex", alignItems:"center", gap:8, flexWrap:"wrap"}}>
            <span style={{fontSize:15, fontWeight:700, color:"#e2e8f0"}}>{phase}</span>
            {isCurrent && (
              <span style={{fontSize:10, background:pc+"33", color:pc, padding:"2px 8px", borderRadius:99, fontWeight:700}}>CURRENT</span>
            )}
          </div>
          <div style={{fontSize:12, color:"#94a3b8", marginTop:2}}>{rir} Â· {weekDone}/6 sessions done</div>
        </div>
        <span style={{
          color:"#334155", fontSize:22, flexShrink:0,
          transform: isExpanded ? "rotate(90deg)" : "none", transition:"transform 0.2s",
        }}>â€º</span>
      </button>

      {isExpanded && (
        <div style={{
          border:`1px solid ${isCurrent ? pc : "#1e2d47"}`,
          borderTop:"none", borderRadius:"0 0 12px 12px", overflow:"hidden",
        }}>
          {ACTIVE_DAYS.map((day, i) => {
            const done = completedDays.has(`${i}:${weekIdx}`);
            const accent = TAG_ACCENT[day.tag];
            return (
              <button key={i} onClick={()=>onSelectDay(i, weekIdx)} style={{
                width:"100%", textAlign:"left",
                background: done ? accent+"0d" : "#0f1829",
                border:"none",
                borderBottom: i < DAYS.length-1 ? "1px solid #111827" : "none",
                padding:"14px 16px", cursor:"pointer",
                display:"flex", alignItems:"center", gap:12, transition:"background 0.15s",
              }}>
                <div style={{
                  width:38, height:38, borderRadius:8, flexShrink:0,
                  background:accent+"22", display:"flex", alignItems:"center", justifyContent:"center",
                }}>
                  <span style={{fontSize:10, fontWeight:800, color:accent}}>{day.tag}</span>
                </div>
                <div style={{flex:1, minWidth:0}}>
                  <div style={{fontSize:14, fontWeight:700, color: done ? "#4a6080" : "#e2e8f0"}}>Day {day.dayNum} â€” {day.label}</div>
                  <div style={{fontSize:11, color:"#94a3b8", marginTop:2}}>{day.muscles}</div>
                  {day.cardio && <div style={{fontSize:11, color:"#60a5fa", marginTop:1}}>+ {day.cardio}</div>}
                </div>
                {done
                  ? <span style={{fontSize:18, color:"#22c55e", flexShrink:0}}>âœ“</span>
                  : <span style={{color:"#334155", fontSize:20, flexShrink:0}}>â€º</span>
                }
              </button>
            );
          })}
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€ DELOAD SECTION (week 7) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function DeloadSection({ currentWeek, completedDays, isExpanded, onToggle }) {
  const pc = PHASE_COLOR["Deload"];
  const isCurrent = currentWeek === 6;
  const weekDone = ACTIVE_DAYS.filter((_, i) => completedDays.has(`${i}:${MESO.weeks}`)).length;
  return (
    <div style={{marginBottom:8}}>
      <button onClick={onToggle} style={{
        width:"100%", textAlign:"left",
        background: isCurrent ? pc+"18" : "#0d1220",
        border:`1px solid ${isCurrent ? pc : "#1e2d47"}`,
        borderRadius: isExpanded ? "12px 12px 0 0" : 12,
        padding:"14px 16px", cursor:"pointer",
        display:"flex", alignItems:"center", gap:12,
      }}>
        <div style={{
          width:46, height:46, borderRadius:10, flexShrink:0,
          background:pc+"22", display:"flex", flexDirection:"column",
          alignItems:"center", justifyContent:"center",
        }}>
          <span style={{fontSize:14, fontWeight:800, color:pc}}>W7</span>
        </div>
        <div style={{flex:1, minWidth:0}}>
          <div style={{display:"flex", alignItems:"center", gap:8, flexWrap:"wrap"}}>
            <span style={{fontSize:15, fontWeight:700, color:"#e2e8f0"}}>Deload Week</span>
            {isCurrent && <span style={{fontSize:10, background:pc+"33", color:pc, padding:"2px 8px", borderRadius:99, fontWeight:700}}>CURRENT</span>}
          </div>
          <div style={{fontSize:12, color:"#94a3b8", marginTop:2}}>N/A Â· {weekDone}/6 sessions done</div>
        </div>
        <span style={{color:"#334155", fontSize:22, flexShrink:0, transform: isExpanded ? "rotate(90deg)" : "none", transition:"transform 0.2s"}}>â€º</span>
      </button>
      {isExpanded && (
        <div style={{
          border:`1px solid ${isCurrent ? pc : "#1e2d47"}`,
          borderTop:"none", borderRadius:"0 0 12px 12px", overflow:"hidden",
        }}>
          <div style={{padding:"14px 16px", background:"#0f1829", borderBottom:"1px solid #111827"}}>
            <div style={{fontSize:13, fontWeight:700, color:pc, marginBottom:6}}>ğŸŸ£ DELOAD PROTOCOL</div>
            <div style={{fontSize:13, color:"#94a3b8", lineHeight:1.7}}>
              Run the same 6-day split at <strong style={{color:"#e2e8f0"}}>50â€“60% of Week 6 weights</strong>. Drop to <strong style={{color:"#e2e8f0"}}>2 working sets</strong> per exercise. Stop well short of failure â€” this week is about recovery, not stimulus. Your nervous system will thank you next meso.
            </div>
          </div>
          {ACTIVE_DAYS.map((day, i) => {
            const done = completedDays.has(`${i}:${MESO.weeks}`);
            const accent = TAG_ACCENT[day.tag];
            return (
              <div key={i} style={{
                borderBottom: i < DAYS.length-1 ? "1px solid #111827" : "none",
                padding:"12px 16px", background: done ? accent+"0d" : "#0f1829",
                display:"flex", alignItems:"center", gap:12,
              }}>
                <div style={{width:36, height:36, borderRadius:8, background:accent+"22", display:"flex", alignItems:"center", justifyContent:"center", flexShrink:0}}>
                  <span style={{fontSize:10, fontWeight:800, color:accent}}>{day.tag}</span>
                </div>
                <div style={{flex:1}}>
                  <div style={{fontSize:13, fontWeight:700, color: done ? "#4a6080" : "#e2e8f0"}}>Day {day.dayNum} â€” {day.label}</div>
                  <div style={{fontSize:11, color:"#94a3b8", marginTop:1}}>2 sets Â· 50â€“60% W6 weight Â· No failure</div>
                </div>
                {done && <span style={{fontSize:16, color:"#22c55e"}}>âœ“</span>}
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€ HOME VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function HomeView({ currentWeek, setCurrentWeek, onSelectDay, completedDays, onReset }) {
  const [tab, setTab] = useState("schedule");
  const [expandedWeek, setExpandedWeek] = useState(currentWeek);
  const [showReset, setShowReset] = useState(false);

  return (
    <div style={{paddingBottom:120}}>
      {showReset && (
        <ResetDialog
          onCancel={() => setShowReset(false)}
          onConfirmed={() => { setShowReset(false); onReset(); }}
        />
      )}

      {/* Tabs */}
      <div style={{display:"flex", gap:2, padding:"14px 16px 12px"}}>
        {[["schedule","Schedule"],["progress","Progress"],["overview","Meso"],["warmup","Warm-up"]].map(([key,label])=>(
          <button key={key} onClick={()=>setTab(key)} style={{
            flex:1, padding:"10px 4px", borderRadius:8, cursor:"pointer",
            background: tab===key ? "#1e2d47" : "transparent",
            border:`1px solid ${tab===key ? "#334a6b" : "#111827"}`,
            color: tab===key ? "#60a5fa" : "#4a6080",
            fontSize:12, fontWeight:700,
          }}>{label}</button>
        ))}
      </div>

      {tab==="schedule" && (
        <div style={{padding:"0 16px"}}>
          {Array.from({length: MESO.weeks}, (_,w) => (
            <WeekSection
              key={w}
              weekIdx={w}
              currentWeek={currentWeek}
              onSelectDay={(dayIdx, weekIdx) => {
                setCurrentWeek(weekIdx);
                saveCurrentWeek(weekIdx);
                onSelectDay(dayIdx);
              }}
              completedDays={completedDays}
              isExpanded={expandedWeek === w}
              onToggle={() => setExpandedWeek(expandedWeek === w ? null : w)}
            />
          ))}
          <DeloadSection
            currentWeek={currentWeek}
            completedDays={completedDays}
            isExpanded={expandedWeek === MESO.weeks}
            onToggle={() => setExpandedWeek(expandedWeek === MESO.weeks ? null : MESO.weeks)}
          />

          {/* Data management */}
          <div style={{marginTop:24, paddingTop:20, borderTop:"1px solid #1e2d47", display:"flex", flexDirection:"column", gap:10}}>
            <div style={{fontSize:11, fontWeight:700, letterSpacing:"0.12em", color:"#94a3b8", marginBottom:2}}>DATA MANAGEMENT</div>
            <div style={{display:"grid", gridTemplateColumns:"1fr 1fr", gap:10}}>
              <button onClick={exportData} style={{
                padding:"14px 8px", borderRadius:12, cursor:"pointer",
                background:"#0f1829", border:"1px solid #1e3a5f",
                color:"#60a5fa", fontSize:13, fontWeight:700,
              }}>â¬‡ Export Backup</button>
              <label style={{
                padding:"14px 8px", borderRadius:12, cursor:"pointer",
                background:"#0f1829", border:"1px solid #1e3a5f",
                color:"#60a5fa", fontSize:13, fontWeight:700,
                textAlign:"center", display:"block",
              }}>
                â¬† Import Backup
                <input type="file" accept=".json" style={{display:"none"}} onChange={e => {
                  const file = e.target.files?.[0];
                  if (!file) return;
                  importData(file, (ok) => {
                    if (ok) { alert("Data restored! Reloading..."); window.location.reload(); }
                    else { alert("Import failed â€” invalid backup file."); }
                  });
                }} />
              </label>
            </div>
            <button onClick={()=>setShowReset(true)} style={{
              width:"100%", padding:"14px", borderRadius:12, cursor:"pointer",
              background:"transparent", border:"1px solid #ef444444",
              color:"#ef4444", fontSize:14, fontWeight:700, letterSpacing:"0.06em",
            }}>
              âš ï¸ RESET MESO CYCLE
            </button>
          </div>
        </div>
      )}
      {tab==="progress" && <ProgressView currentWeek={currentWeek} completedDays={completedDays} />}
      {tab==="overview" && <MesoOverview />}
      {tab==="warmup"   && <WarmupCard />}
    </div>
  );
}

// â”€â”€â”€ APP ROOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App() {
  const [profile, setProfile]             = useState(loadProfile);
  const [view, setView]                   = useState("home");
  const [selectedDay, setSelectedDay]     = useState(null);
  const [currentWeek, setCurrentWeek]     = useState(loadCurrentWeek);
  const [completedDays, setCompletedDays] = useState(loadCompleted);

  // Request persistent storage on mount (silent â€” prevents browser auto-cleanup)
  useEffect(() => {
    if (navigator.storage && navigator.storage.persist) {
      navigator.storage.persist();
    }
  }, []);

  // Show setup if no profile
  if (!profile) {
    return <SetupPage onComplete={p => {
      saveProfile(p);
      // Reload so MESO recomputes from new mesoLength
      window.location.reload();
    }} />;
  }

  const handleComplete = (dayIdx, weekIdx) => {
    markComplete(dayIdx, weekIdx);
    setCompletedDays(prev => new Set([...prev, `${dayIdx}:${weekIdx}`]));
    // Auto-backup after every completed session
    exportData();
  };

  const handleReset = () => {
    resetMeso();
    // Clear profile so setup page shows again (user can pick new meso length)
    // Page reload ensures MESO config recomputes from scratch
    localStorage.removeItem("ppl:profile");
    window.location.reload();
  };

  const handleNextDay = (dayIdx, weekIdx) => {
    const nextDayIdx = dayIdx + 1;
    if (nextDayIdx <= MESO.days - 1) {
      setSelectedDay(nextDayIdx);
    } else {
      const nextWeek = weekIdx + 1;
      if (nextWeek <= MESO.weeks - 1) {
        setCurrentWeek(nextWeek);
        saveCurrentWeek(nextWeek);
        setSelectedDay(0);
      } else {
        setView("home");
      }
    }
  };

  const phase = WEEK_PHASE[currentWeek];
  const pc    = PHASE_COLOR[phase];

  return (
    <div style={{minHeight:"100vh", background:"#0a0e1a", color:"#e2e8f0", fontFamily:"'DM Sans','Segoe UI',system-ui,sans-serif", maxWidth:480, margin:"0 auto"}}>
      {/* Header */}
      <div style={{background:"#0d1220", borderBottom:"1px solid #1e2d47", padding:"16px 20px 12px", position:"sticky", top:0, zIndex:50}}>
        <div style={{display:"flex", justifyContent:"space-between", alignItems:"center"}}>
          <div>
            <div style={{fontSize:13, fontWeight:700, letterSpacing:"0.15em", color:"#60a5fa"}}>PPL TRAINING</div>
            <div style={{fontSize:11, color:"#94a3b8", letterSpacing:"0.06em", marginTop:2}}>
              {profile.name ? `${profile.name} Â· ` : ""}{MESO.weeks}-Week Â· {MESO.days}x/Week PPL
            </div>
          </div>
          <div style={{textAlign:"right"}}>
            <div style={{fontSize:13, fontWeight:800, color:pc}}>Week {currentWeek+1}</div>
            <div style={{fontSize:10, color:"#94a3b8"}}>{phase} Â· {WEEK_RIR[currentWeek]}</div>
          </div>
        </div>
      </div>

      {view==="home" && (
        <HomeView
          currentWeek={currentWeek}
          setCurrentWeek={setCurrentWeek}
          onSelectDay={i=>{setSelectedDay(i); setView("day");}}
          completedDays={completedDays}
          profile={profile}
          onReset={handleReset}
        />
      )}
      {view==="day" && selectedDay!==null && (
        <DayView
          dayIdx={selectedDay}
          weekIdx={currentWeek}
          onBack={()=>{ window.scrollTo(0,0); setView("home"); }}
          onComplete={handleComplete}
          onNextDay={handleNextDay}
          completedDays={completedDays}
          profile={profile}
        />
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
